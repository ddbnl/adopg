<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    @import "node_modules/azure-devops-ui/Core/_platformCommon.scss";
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>
    <script type="module">
        function MakeApiCall(url, method) {
            console.debug(`Call: ${url}`)
            return new Promise((resolve) => {
                fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json;charset=utf-8',
                        //'Authorization': authHeader
                    },
                }).then(response => {
                    console.log(`Response is ok: ${response.ok}`);
                    if (response.ok) {
                        return response.json();
                    }
                    resolve();
                }).then(data => {
                    console.log(data);
                    resolve();
                }).catch(err => {
                    console.log(err);
                    resolve();
                });
                console.debug(`Finish Call: ${url}`)
            });
        }

        window.requirejs.config({
            enforceDefine: true,
            paths: {
                'SDK': './lib/SDK.min'
            }
        });
        let authHeader;
        window.requirejs(['SDK'], function (SDK) {
            if (typeof SDK !== 'undefined') {
                console.log("SDK is defined. Trying to initialize...");
                SDK.init();
                SDK.ready().then(() => {
                    console.log("SDK is ready");

                    WidgetHelpers.IncludeWidgetStyles();
                    
                    document.getElementById("name").innerText = SDK.getUser().displayName;
                    MakeApiCall(`http://localhost:5214/connect?organization=${SDK.name}`, "POST").then(r => {
                        MakeApiCall("http://localhost:5214/refresh", "POST").then(r => {
                            MakeApiCall("http://localhost:5214/projects/Test/repositories/Test", "GET").then(r => {
                                console.log("Finish setup");
                            });
                        })
                    });
                });
            } else {
                console.log('SDK is not defined');
            }
        });

        //
    </script>
    <style>
        body {
            background-color: rgb(0, 67, 117);
            color: white;
            margin: 10px;
            font-family: "Segoe UI VSS (Regular)","-apple-system",BlinkMacSystemFont,"Segoe UI",sans-serif;
        }
    </style>
</head>
<body>
<h1>Hello, <span id="name"></span></h1>
</body>
</html>